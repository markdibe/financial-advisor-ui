<div class="chat-container">
    <!-- Header -->
    <div class="chat-header">
        <div class="header-left">
            <h1>Financial Advisor AI</h1>
            <span class="subtitle">Ask me anything about your clients</span>
        </div>
        <div class="header-right">
            <button class="btn-emails" (click)="toggleEmailPanel()" [class.active]="showEmailPanel">
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
        >
          <path
            d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"
            stroke-width="2"
          />
          <path d="M22 6l-10 7L2 6" stroke-width="2" />
        </svg>
        <span>Emails</span>
        <span *ngIf="syncStatus?.emailCount" class="email-badge">{{
          syncStatus?.emailCount
        }}</span>
      </button>
            <span class="user-email">{{ currentUser?.email }}</span>
            <button class="btn-clear" (click)="clearChat()" title="Clear chat">
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
        >
          <path
            d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"
            stroke-width="2"
            stroke-linecap="round"
          />
        </svg>
      </button>
            <button class="btn-logout" (click)="logout()">Logout</button>
        </div>
    </div>

    <div class="main-content">
        <!-- Email Sidebar -->
        <div class="email-sidebar" [class.open]="showEmailPanel">
            <div class="email-sidebar-header">
                <h3>ðŸ“§ Gmail</h3>
                <button class="btn-sync" (click)="syncEmails()" [disabled]="isSyncing">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            [class.spinning]="isSyncing"
          >
            <path
              d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"
              stroke-width="2"
            />
          </svg>
          {{ isSyncing ? "Syncing..." : "Sync" }}
        </button>
            </div>

            <div class="email-sync-info" *ngIf="syncStatus">
                <small *ngIf="syncStatus.lastSync">
          Last sync: {{ syncStatus.lastSync | date : "short" }}
        </small>
                <small *ngIf="!syncStatus.hasSynced" class="sync-prompt">
          Click Sync to import your emails
        </small>
            </div>

            <div class="email-list" *ngIf="!isLoadingEmails && emails.length > 0">
                <div class="email-item" *ngFor="let email of emails" [class.unread]="!email.isRead">
                    <div class="email-item-header">
                        <span class="email-from">{{ email.fromEmail }}</span>
                        <span class="email-date">{{
              email.emailDate | date : "MMM d"
            }}</span>
                    </div>
                    <div class="email-subject">{{ email.subject }}</div>
                    <div class="email-snippet">{{ email.snippet }}</div>
                </div>
            </div>

            <div class="email-loading" *ngIf="isLoadingEmails">
                <div class="spinner-small"></div>
                <p>Loading emails...</p>
            </div>

            <div class="email-empty" *ngIf="!isLoadingEmails && emails.length === 0 && syncStatus?.hasSynced">
                <p>No emails found</p>
            </div>
        </div>

        <!-- Messages Container -->
        <div class="messages-wrapper" [class.sidebar-open]="showEmailPanel">
            <div class="messages-container" #messagesContainer>
                <!-- Loading State -->
                <div *ngIf="isLoading" class="loading-state">
                    <div class="spinner"></div>
                    <p>Loading chat history...</p>
                </div>

                <!-- Empty State -->
                <div *ngIf="!isLoading && messages.length === 0" class="empty-state">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path
              d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
                    <h3>Start a conversation</h3>
                    <p>
                        Ask me about your clients, schedule meetings, or manage your tasks.
                    </p>
                    <div class="example-prompts">
                        <button class="example-prompt" (click)="newMessage = 'Who are my recent clients?'; sendMessage()">
              Who are my recent clients?
            </button>
                        <button class="example-prompt" (click)="
                newMessage = 'What meetings do I have this week?'; sendMessage()
              ">
              What meetings do I have this week?
            </button>
                        <button class="example-prompt" (click)="
                newMessage = 'Help me draft an email to a client'; sendMessage()
              ">
              Help me draft an email
            </button>
                    </div>
                </div>

                <!-- Messages -->
                <div *ngFor="let message of messages" class="message" [class.user-message]="message.role === 'user'" [class.assistant-message]="message.role === 'assistant'">
                    <div class="message-avatar">
                        <span *ngIf="message.role === 'user'">ðŸ‘¤</span>
                        <span *ngIf="message.role === 'assistant'">ðŸ¤–</span>
                    </div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-role">{{
                message.role === "user" ? "You" : "AI Assistant"
              }}</span>
                            <span class="message-time">{{
                message.createdAt | date : "short"
              }}</span>
                        </div>
                        <div class="message-text">{{ message.content }}</div>
                    </div>
                </div>

                <!-- Typing Indicator -->
                <div *ngIf="isSending" class="message assistant-message typing-indicator">
                    <div class="message-avatar">
                        <span>ðŸ¤–</span>
                    </div>
                    <div class="message-content">
                        <div class="typing-dots">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="input-container">
                <div class="input-wrapper">
                    <textarea [(ngModel)]="newMessage" (keypress)="onKeyPress($event)" placeholder="Type your message... (Press Enter to send, Shift+Enter for new line)" rows="1" [disabled]="isSending" class="message-input">
          </textarea>
                    <button class="send-button" (click)="sendMessage()" [disabled]="!newMessage.trim() || isSending" [class.sending]="isSending">
            <svg
              *ngIf="!isSending"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
            >
              <path
                d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
            <div *ngIf="isSending" class="button-spinner"></div>
          </button>
                </div>
            </div>
        </div>
    </div>
</div>